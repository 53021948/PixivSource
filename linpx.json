[
  {
    "bookSourceComment": "linpx是pixiv的子集 包含所有兽人小说",
    "bookSourceGroup": "pixiv",
    "bookSourceName": "linpx",
    "bookSourceType": 0,
    "bookSourceUrl": "https://www.furrynovel.xyz",
    "customOrder": 0,
    "enabled": true,
    "enabledCookieJar": false,
    "enabledExplore": true,
    "enabledReview": false,
    "lastUpdateTime": 1673328140591,
    "respondTime": 180000,
    "ruleBookInfo": {
      "author": "author",
      "coverUrl": "cover_url",
      "init": "@js:\nvar userMap = new Map();\nvar ajaxCount = 0;\n\n(function (res) {\n    function findUser(userId) {\n        let obj = userMap.get(userId);\n        if (obj === undefined || obj === null) {\n            obj = java.ajax(`https://linpxapi.linpicio.com/pixiv/user/${userId}`)\n            ajaxCount++\n            userMap.set(userId, JSON.parse(obj))\n        }\n        return obj\n    }\n\n    function findSeriesId(userInfo, seriesTitle) {\n        userInfo = JSON.parse(userInfo)\n        let id = 0\n        userInfo.series.forEach((series, i) => {\n            if (series.title === seriesTitle) {\n                id = series.id\n            }\n        })\n        return id\n    }\n\n\n    res = JSON.parse(res)\n    let prop = {}\n    prop['author'] = res.userName\n    prop['count'] = book.wordCount\n    prop['desc'] = res.desc\n    prop['cover_url'] = `https://linpxapi.linpicio.com/proxy/pximg?url= ${res.coverUrl}`\n\n    if (res.series == null) {\n        prop['name'] = res.title\n        prop['catalog'] = `https://linpxapi.linpicio.com/pixiv/novel/${res.id}`\n        prop['classes'] = '单本,'\n    } else {\n        prop['name'] = res.series.title\n        prop['classes'] = '长篇,'\n        //查询用户\n        let userInfo = findUser(res.userId)\n        prop['catalog'] = `https://linpxapi.linpicio.com/pixiv/series/${findSeriesId(userInfo, res.series.title)}`\n    }\n    if (res.tags !== undefined) {\n        prop['classes'] += res.tags.join(\",\")\n    }\n    return prop\n\n})(result)",
      "intro": "desc",
      "kind": "classes",
      "lastChapter": "latest_chapter",
      "name": "name",
      "tocUrl": "catalog",
      "wordCount": "count"
    },
    "ruleContent": {
      "content": "@js:\n(function (res) {\n    res = JSON.parse(res)\n    let content = res.content\n    //链接替换 如果有的话\n    if (res.images !== undefined && res.images !== null) {\n        Object.keys(res.images).forEach((key) => {\n            content = content.replace(`[uploadedimage:${key}]`, `<img src=\"https://linpxapi.linpicio.com/proxy/pximg?url=${res.images[key].preview}\">`)\n        })\n    }\n    return content\n})(result)",
      "replaceRegex": "",
      "sourceRegex": ""
    },
    "ruleSearch": {
      "author": "userName",
      "bookList": "@js:\nfunction getUser(username, exactMatch) {\n    // 修复传入object的bug\n    username = String(username)\n    let resp = JSON.parse(java.ajax(`https://linpxapi.linpicio.com/pixiv/search/user/${username}`))\n    if (resp.users.length === 0) {\n        return []\n    }\n    if (!exactMatch) {\n        return resp.users\n    }\n    // 只返回用户名完全一样的用户\n    return resp.users.filter(user => {\n        if (user.name === username) {\n            return true\n        }\n    })\n}\n\nfunction getWebviewJson(url) {\n    let html = java.webView(null, url, null)\n    return JSON.parse((html.match(new RegExp(\">\\\\[\\\\{.*?}]<\"))[0].replace(\">\", \"\").replace(\"<\", \"\")))\n}\n\n// 包含所有小说数据\nfunction getUserDetailedList(uidList) {\n    java.log(`UIDLIST:${JSON.stringify(uidList)}`)\n    let url = `https://linpxapi.linpicio.com/pixiv/users?${uidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    return getWebviewJson(url)\n}\n\nfunction getNovels(nidList) {\n    //todo 简单的限制\n    if (nidList.length > 30) {\n        nidList.length = 30\n    }\n    java.log(`NIDLIST:${JSON.stringify(nidList)}`)\n    let url = `https://linpxapi.linpicio.com/pixiv/novels?${nidList.map(v => \"ids[]=\" + v).join(\"&\")}`\n    return getWebviewJson(url)\n}\n\n// 将多个长篇小说解析为一本书\nfunction combineNovels(novels) {\n    let newNovels = []\n    // key为seriesId value为novel\n    let seriesMap = new Map()\n    novels.forEach(novel => {\n        // 视为真正的一本书\n        if (novel.seriesId !== undefined && novel.seriesTitle !== undefined) {\n            let v = seriesMap.get(novel.seriesId);\n            if (v === undefined || v === null) {\n                seriesMap.set(novel.seriesId, novel)\n                newNovels.push(novel)\n            }\n        } else {\n            // 短篇小说\n            newNovels.push(novel)\n        }\n    })\n    return newNovels\n}\n\n// 将小说的封面规则与详情地址替换\nfunction formatNovels(novels) {\n    novels.forEach(novel => {\n        novel.coverUrl = `https://linpxapi.linpicio.com/proxy/pximg?url=${novel.coverUrl}`\n        novel.detailedUrl = `https://linpxapi.linpicio.com/pixiv/novel/${novel.id}/cache`\n        if (novel.seriesId !== undefined && novel.seriesTitle !== undefined){\n            novel.tags.unshift(\"长篇\")\n        }else {\n            novel.tags.unshift(\"单本\")\n        }\n        \n        novel.tags = novel.tags.join(\",\")\n    })\n    return novels\n}\n\nfunction findUserNovels(username) {\n    let novelList = []\n\n    // 查询用户\n    let userArr = getUser(username, true)\n    // 获取用户所有小说\n    let uidList = userArr.filter(user => {\n        return user.novels.length > 0\n    }).map(user => user.id)\n\n    if (uidList.length > 0) {\n        let list = getUserDetailedList(uidList)\n        let nidList = []\n        // 从两层数组中提取novelsId\n        list.forEach(user => {\n            user.novels.forEach(nid => nidList.push(nid))\n        })\n        getNovels(nidList).forEach(novel => {\n            novelList.push(novel)\n        })\n    }\n\n    return novelList\n}\n\n\n(function (res) {\n    res = JSON.parse(res)\n    let novels = findUserNovels(java.get(\"key\"))\n    res.novels.forEach(v => {\n        novels.push(v)\n    })\n    return formatNovels(combineNovels(novels))\n\n}(result))",
      "bookUrl": "detailedUrl",
      "coverUrl": "coverUrl",
      "intro": "desc",
      "kind": "tags",
      "name": "title",
      "wordCount": "length"
    },
    "ruleToc": {
      "chapterList": "@js:\n(function (res) {\n    res = JSON.parse(res)\n    if (res.novels !== undefined) {\n        res.novels.forEach(v => {\n            v['url'] = `https://linpxapi.linpicio.com/pixiv/novel/${v.id}`\n        })\n        return res.novels\n    }\n    return [{\n        id: res.id,\n        title: res.title\n    }]\n})(result)",
      "chapterName": "title",
      "chapterUrl": "url"
    },
    "searchUrl": "@js:\njava.put(\"key\",key);`https://linpxapi.linpicio.com/pixiv/search/novel/${encodeURI(key)}?page=${page}`",
    "weight": 0
  }
]